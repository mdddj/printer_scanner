# 网络打印机发现工具

这是一个基于 Rust 编写的高性能网络打印机发现工具。它通过扫描指定的 IP 网段，利用多种协议探测并识别网络中的打印机设备，尤其对斑马（Zebra）标签打印机有特定的检测优化。

## ✨ 特性

- **多协议探测**: 综合使用 PJL、Zebra SGD/ZPL、SNMP 及 Raw Banner 等多种方式识别设备型号。
- **高性能扫描**: 利用 `tokio` 异步运行时和并发控制，快速扫描整个网段。
- **智能识别**: 优先使用最可靠的协议（如 Zebra SGD）进行探测，保证识别的准确性。
- **简单易用**: 通过命令行参数即可轻松指定扫描范围、超时时间和并发数。
- **友好输出**: 使用彩色高亮输出结果，清晰展示发现的设备 IP、型号和识别来源。

## 🚀 使用方法

### 编译与运行

你需要安装 Rust 环境。

1. **克隆项目**
   ```bash
   git clone <repository_url>
   cd printer_scanner
   ```

2. **直接运行**
   使用 `cargo run` 来编译并运行程序。你可以附加参数来自定义扫描行为。

   ```bash
   cargo run -- [OPTIONS]
   ```

### 命令行参数

- `-n, --network <NETWORK>`
  - **功能**: 指定要扫描的 CIDR 网络地址。
  - **默认值**: `192.168.199.0/24`
  - **示例**: `--network 192.168.1.0/24`

- `-t, --timeout-ms <TIMEOUT_MS>`
  - **功能**: 设置每个 IP 的连接超时时间（毫秒）。
  - **默认值**: `2000`
  - **示例**: `--timeout-ms 3000`

- `-c, --concurrency <CONCURRENCY>`
  - **功能**: 设置并发扫描的任务数量。
  - **默认值**: `50`
  - **示例**: `--concurrency 100`

## 📋 示例

扫描 `192.168.31.0/24` 网段，设置超时为 3 秒，并发数为 100：

```bash
cargo run -- -n 192.168.31.0/24 -t 3000 -c 100
```

### 输出样例

```
🚀 正在扫描: 192.168.31.0/24 (包含 Zebra SGD 深度检测)

--- 扫描结果 ---
🖨️  Found: 192.168.31.10
   └─ Model: Zebra GX430t (SGD (Zebra))

🖨️  Found: 192.168.31.25
   └─ Model: HP LaserJet Pro M404dn (PJL)

🖨️  Found: 192.168.31.55
   └─ Model: Ricoh IM C3000 (SNMP)

```

## 🛠️ 工作原理

该工具的探测逻辑按以下优先级顺序执行：

1.  **端口检查**: 首先确认目标 IP 的 `9100` 端口是否开放，这是大多数网络打印机的标准端口。
2.  **Zebra SGD 探测**: 发送 `! U1 getvar "device.product_name"` 指令，这是识别现代斑马打印机最可靠的方法。
3.  **PJL 探测**: 发送 `@PJL INFO ID` 指令，适用于 HP、Brother 等众多品牌的通用打印机。
4.  **Zebra ZPL 探测**: 发送 `~HI` 指令，作为识别老式斑马打印机的备用方法。
5.  **SNMP 探测**: 查询 OID `1.3.6.1.2.1.1.1.0` (sysDescr) 来获取设备描述，这是一种通用的网络设备管理协议。
6.  **Raw Banner 捕获**: 如果以上方法均失败，工具会尝试直接连接端口并等待设备主动发送的欢迎信息（Banner），作为最后的识别线索。